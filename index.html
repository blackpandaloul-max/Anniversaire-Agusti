<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anniversaire Agust√≠ üéâ</title>
  <style>
    :root{
      --bg:#0b0b0b;
      --card:#111;
      --accent:#dc143c; /* rouge */
      --muted:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #050505 0%, #0b0b0b 100%);
      color:var(--muted);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
      padding:20px;
      overflow-x:hidden;
    }
    .wrap{max-width:1000px;margin:0 auto}

    header{
      text-align:center;
      padding:28px 12px;
      background: linear-gradient(180deg,var(--accent),#000);
      border-radius:12px;
      box-shadow: 0 8px 30px rgba(220,20,60,0.15);
      margin-bottom:18px;
    }
    header h1{margin:0;font-size:32px}
    header p{margin:8px 0 0;color:#ffd6dc}

    /* countdown */
    #countdown{
      margin:18px auto 8px;
      text-align:center;
      font-size:18px;
      color:#ffd6dc;
      font-weight:600;
    }
    #countdown .time{
      display:inline-block;
      background:rgba(255,255,255,0.03);
      padding:10px 14px;
      border-radius:10px;
      margin:0 6px;
      min-width:68px;
    }

    /* layout */
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      border-radius:12px;
      padding:18px;
    }

    /* messages */
<h2>üíå Messages re√ßus :</h2>
<div id="messages">Chargement des messages‚Ä¶</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzdEQWcuSQKETslTpCT-z6CWFbOJei7wGF8dvvXqz5kzzwYj7qOxKf3SvWoUjOdqMtz/exec";

async function loadMessages() {
  try {
    const response = await fetch(SCRIPT_URL);
    const data = await response.json();

    if (!data || data.length === 0) {
      document.getElementById("messages").innerText = "Aucun message pour le moment ü•∫";
      return;
    }

    let html = "";
    data.reverse().forEach(msg => {
      html += "<div class='message'>" + msg.message;
      if (msg.name && msg.name.trim() !== "") {
        html += "<div style='margin-top:6px;font-size:14px;color:#ffccd3'>‚Äî " + msg.name + "</div>";
      }
      html += "</div>";
    });

    document.getElementById("messages").innerHTML = html;

  } catch (error) {
    console.error(error);
    document.getElementById("messages").innerText = "Impossible de charger les messages pour le moment.";
  }
}

// Charger les messages imm√©diatement et toutes les 10 secondes
loadMessages();
setInterval(loadMessages, 10000);
</script>
    /* hearts */
    .heart {
      position: fixed;
      top: -40px;
      font-size: 20px;
      pointer-events:none;
      opacity:0.95;
      transform: translateY(0);
    }

    /* big surprise overlay */
    #overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      pointer-events: none;
    }
    #overlay .panel{
      background: linear-gradient(90deg, rgba(0,0,0,0.6), rgba(20,0,0,0.6));
      border: 2px solid rgba(255,255,255,0.06);
      padding: 30px;
      border-radius: 16px;
      text-align:center;
      color: white;
      transform: scale(0.8);
      transition: transform .4s ease;
      pointer-events: auto;
    }
    #overlay.show{ display:flex; }
    #overlay.show .panel{ transform: scale(1); }

    #overlay h2{
      font-size:38px;
      margin:0 0 12px 0;
      text-shadow:0 6px 30px rgba(220,20,60,0.25);
    }
    #overlay p{font-size:20px;margin:0 0 12px 0;color:#ffe6ea}
    #overlay .closeBtn{
      margin-top:10px;
      display:inline-block;
      background:var(--accent);
      color:white;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      text-decoration:none;
    }

    /* confetti canvas full screen */
    #confetti-canvas{
      position: fixed;
      top:0;left:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9998;
    }

    footer{color:#999;text-align:center;margin-top:18px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üéÇ Joyeux 17√®me Anniversaire Agust√≠ ‚ù§Ô∏è</h1>
      <p>D√©pose ton message, une anecdote ou un simple joyeux anniversaire!</p>
    </header>

    <!-- countdown visible -->
    <div id="countdown" aria-hidden="false">
      <span style="margin-right:12px">Compte √† rebours jusqu‚Äôau grand moment :</span>
      <span class="time" id="days">--j</span>
      <span class="time" id="hours">--h</span>
      <span class="time" id="minutes">--m</span>
      <span class="time" id="seconds">--s</span>
    </div>

    <div class="grid">
      <!-- left -->
      <section class="card">
        <h2>üì¨ Laisse un message</h2>

        <!-- Google Form embed (TU AS D√âJ√Ä COLL√â LE BON IFRAME) -->
        <div style="margin-top:12px">
          <iframe
            src="https://docs.google.com/forms/d/e/1FAIpQLSdvtjXWe_PR2TGo1p7vK5auZOUzAo-H81PVJZqoSsQ8bzsSVw/viewform?embedded=true"
            width="100%" height="900" frameborder="0" marginheight="0" marginwidth="0">
            Chargement‚Ä¶
          </iframe>
        </div>

        <hr style="border:none;height:18px">

        <h2>üíå Messages re√ßus</h2>
        <div id="messages">Chargement des messages‚Ä¶</div>
      </section>

      <!-- right -->
      <aside class="card">
        <strong>Infos</strong>
        <p style="margin-top:12px;color:#ffd6dc"><strong>Animation sp√©ciale :</strong><br>16 novembre √† 00:20 (Europe/Paris)</p>
      </aside>
      </div>

    <footer>¬© made by koko ‚Ä¢ üçì‚ù§Ô∏è</footer>
  </div>

  <!-- confetti canvas -->
  <canvas id="confetti-canvas"></canvas>

  <!-- overlay surprise -->
  <div id="overlay">
    <div class="panel">
      <h2 id="overlay-title">Joyeux anniversaire Agust√≠ !</h2>
      <p id="overlay-msg">Joyeux anniversaire mon c≈ìur, je suis officiellement plus une cougar!! üçì‚ù§Ô∏è</p>
      <a class="closeBtn" id="closeOverlay">Fermer</a>
    </div>
  </div>

  <!-- hearts generator (continuous) -->
  <script>
    function spawnHeart() {
      const el = document.createElement('div');
      el.className = 'heart';
      el.innerText = '‚ù§';
      el.style.left = Math.random() * 100 + 'vw';
      el.style.fontSize = (12 + Math.random() * 28) + 'px';
      el.style.opacity = (0.6 + Math.random() * 0.4);
      el.style.transition = 'transform linear';
      document.body.appendChild(el);
      const duration = 5000 + Math.random() * 6000;
      el.animate([
        { transform: 'translateY(0) rotate(0deg)', opacity: el.style.opacity },
        { transform: 'translateY(120vh) rotate(360deg)', opacity: 0.1 }
      ], { duration: duration, iterations: 1, easing: 'linear' });
      setTimeout(()=> el.remove(), duration + 200);
    }
    setInterval(spawnHeart, 600);
  </script>

  <!-- YouTube IFrame API (allows setVolume) -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <!-- hidden player container -->
  <div id="yt-player" style="display:none"></div>

  <script>
    // ---------- YouTube setup ----------
    // video id (from your link)
    const YT_ID = "C4_REFc14ko";
    let ytPlayer;
    function onYouTubeIframeAPIReady() {
      ytPlayer = new YT.Player('yt-player', {
        height: '0', width: '0',
        videoId: YT_ID,
        playerVars: {
          autoplay: 1,
          loop: 1,
          playlist: YT_ID,
          controls: 0,
          modestbranding: 1,
          rel: 0,
          mute: 0
        },
        events: {
          onReady: function(e){
            // try to autoplay (may be blocked)
            try { e.target.playVideo(); e.target.setVolume(25); } catch(err){}
          }
        }
      });
    }

    // ---------- Load messages from published Google Sheet (CSV) ----------
    async function loadMessages(){
      try {
        const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHRXor6OLBeikq2SSUHAVLcfeRjl9iKFF-qb4q3BK8df-5-a_S_EAJzhUVjrOTz1LynUi_JjcbynL9/pub?output=csv";
        const res = await fetch(sheetCSV);
        if(!res.ok) throw new Error('Erreur t√©l√©chargement');
        const txt = await res.text();
        // parse CSV safely (basic)
        const lines = txt.trim().split('\n');
        if(lines.length <= 1){ document.getElementById('messages').innerText = "Aucun message pour le moment ü•∫"; return; }
        const headers = lines[0].split(',');
        const rows = lines.slice(1);
        let html = '';
        // display newest first
        rows.reverse().forEach(r=>{
          if(!r) return;
          // handle commas inside cells by splitting respecting quotes - simple CSV parse:
          const cols = parseCSVRow(r);
          // assume message is one of the columns - attempt to find the longest column (likely the message)
          let message = cols[1] || cols[0] || '';
          // if header contains 'Message' or 'message', try to use that index
          const msgIndex =
            headers.findIndex(h => /message|Message|MESSAGE|r√©ponse|R√©ponse/.test(h));
          if(msgIndex >= 0 && cols[msgIndex]) message = cols[msgIndex];
          // optional name column detection
          let name = '';
          const nameIndex = headers.findIndex(h => /pr[e√©]nom|nom|Name|name/.test(h));
          if(nameIndex >= 0 && cols[nameIndex]) name = cols[nameIndex];
          message = sanitizeHTML(message);
          name = sanitizeHTML(name);
          if(message.trim() === '') return;
          html += `<div class="message">${message}${name? `<div style="margin-top:8px;color:#ffccd3;font-size:13px">‚Äî ${name}</div>`:''}</div>`;
        });
        document.getElementById('messages').innerHTML = html || "Aucun message pour le moment ü•∫";
      } catch(err){
        document.getElementById('messages').innerText = "Impossible de charger les messages pour le moment.";
        console.error(err);
      }
    }
    // very small CSV row parser (handles quoted fields)
    function parseCSVRow(row){
      const res=[]; let cur=''; let inQuotes=false;
      for(let i=0;i<row.length;i++){
        const ch=row[i];
        if(ch==='\"'){ if(inQuotes && row[i+1]==='\"'){ cur+='"'; i++; } else inQuotes=!inQuotes; continue; }
        if(ch===',' && !inQuotes){ res.push(cur); cur=''; continue; }
        cur+=ch;
      }
      res.push(cur);
      return res;
    }
    function sanitizeHTML(s){
      return s.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
    }
    loadMessages();
    setInterval(loadMessages,10000);

    // ---------- Countdown & Trigger ----------
    // target: 16 Nov 2025 00:20 Europe/Paris (UTC+1 in Nov)
    const targetISO = '2025-11-16T00:20:00+01:00';
    const targetTime = new Date(targetISO).getTime();
    function updateCountdown(){
      const now = Date.now();
      let diff = targetTime - now;
      if(diff <= 0){
        document.getElementById('days').innerText = '00j';
        document.getElementById('hours').innerText = '00h';
        document.getElementById('minutes').innerText = '00m';
        document.getElementById('seconds').innerText = '00s';
        // trigger once
        if(!window.__surprise_done){
          window.__surprise_done = true;
          triggerSurprise();
        }
        return;
      }
      const d = Math.floor(diff / (1000*60*60*24));
      diff -= d*(1000*60*60*24);
      const h = Math.floor(diff/(1000*60*60)); diff -= h*(1000*60*60);
      const m = Math.floor(diff/(1000*60)); diff -= m*(1000*60);
      const s = Math.floor(diff/1000);
      document.getElementById('days').innerText = String(d).padStart(2,'0')+'j';
      document.getElementById('hours').innerText = String(h).padStart(2,'0')+'h';
      document.getElementById('minutes').innerText = String(m).padStart(2,'0')+'m';
      document.getElementById('seconds').innerText = String(s).padStart(2,'0')+'s';
    }
    updateCountdown();
    setInterval(updateCountdown,1000);

    // ---------- Surprise animation ----------
    const overlay = document.getElementById('overlay');
    const overlayMsg = document.getElementById('overlay-msg');
    function triggerSurprise(){
      // show overlay
      overlayMsg.innerText = "Joyeux anniversaire mon c≈ìur, je suis officiellement plus une cougar!! üçì‚ù§Ô∏è";
      overlay.classList.add('show');

      // boost hearts density
      const heartInterval = setInterval(()=>{
        for(let i=0;i<6;i++) spawnExtraHeart();
      }, 200);

      // start confetti burst
      startConfettiBurst(2000);

      // full screen flash
      flashScreen();

      // boost music if possible
      try {
        if(ytPlayer && ytPlayer.setVolume){
          let vol = 100;
          ytPlayer.setVolume(vol);
          // after 6s, fade back to 30
          setTimeout(()=>fadeVolume(100, 30, 3000), 6000);
        }
      } catch(e){ console.warn('yt control', e); }

      // enlarge overlay panel and auto-hide after 18s
      setTimeout(()=> {
        overlay.classList.remove('show');
        clearInterval(heartInterval);
      }, 18000);
    }

    document.getElementById('closeOverlay').addEventListener('click', ()=>{
      overlay.classList.remove('show');
    });

    // helper to spawn many hearts quickly
    function spawnExtraHeart(){
      const el = document.createElement('div');
      el.className = 'heart';
      el.innerText = '‚ù§';
      el.style.left = Math.random()*100 + 'vw';
      el.style.fontSize = (18 + Math.random()*34) + 'px';
      el.style.opacity = 0.9;
      document.body.appendChild(el);
      const duration = 4000 + Math.random()*4000;
      el.animate([
        { transform: 'translateY(0) rotate(0deg)', opacity: el.style.opacity },
        { transform: 'translateY(120vh) rotate(360deg)', opacity: 0.1 }
      ], { duration: duration, iterations: 1, easing: 'cubic-bezier(.2,.8,.2,1)' });
      setTimeout(()=> el.remove(), duration+200);
    }

    // fade volume helper
    function fadeVolume(from, to, ms){
      const steps = 30;
      const stepTime = ms/steps;
      let cur = from;
      const delta = (to-from)/steps;
      const t = setInterval(()=>{
        cur += delta;
        if(ytPlayer && ytPlayer.setVolume) {
          try { ytPlayer.setVolume(Math.max(0, Math.min(100, Math.round(cur)))); } catch(e){}
        }
      }, stepTime);
      setTimeout(()=>clearInterval(t), ms+50);
    }

    // ---------- Confetti (red & black) ----------
    const confettiCanvas = document.getElementById('confetti-canvas');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiPieces = [];

    function resizeCanvas(){
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function random(min,max){ return Math.random()*(max-min)+min; }

    function spawnConfetti(count){
      for(let i=0;i<count;i++){
        confettiPieces.push({
          x: random(0, confettiCanvas.width),
          y: random(-confettiCanvas.height, 0),
          w: random(6,12),
          h: random(6,14),
          r: random(0,360),
          speed: random(2,6),
          rotSpeed: random(-8,8),
          color: Math.random()>0.5 ? '#dc143c' : '#000'
        });
      }
    }

    function drawConfetti(){
      confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confettiPieces.forEach((p,i)=>{
        p.y += p.speed;
        p.r += p.rotSpeed;
        confettiCtx.save();
        confettiCtx.translate(p.x, p.y);
        confettiCtx.rotate(p.r * Math.PI/180);
        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        confettiCtx.restore();
        if(p.y > confettiCanvas.height + 20) confettiPieces.splice(i,1);
      });
      requestAnimationFrame(drawConfetti);
    }
    drawConfetti();

    // burst helper
    function startConfettiBurst(ms){
      spawnConfetti(250);
      // a few waves
      const waves = 4;
      for(let i=1;i<=waves;i++){
        setTimeout(()=> spawnConfetti(120), i*400);
      }
    }

    // a small flash effect
    function flashScreen(){
      const flash = document.createElement('div');
      flash.style.position='fixed';
      flash.style.inset='0';
      flash.style.background='#fff';
      flash.style.opacity='0.0';
      flash.style.zIndex='9997';
      flash.style.pointerEvents='none';
      document.body.appendChild(flash);
      let t=0;
      const interval = setInterval(()=>{
        t++;
        flash.style.opacity = (t<3? 0.35: (t<6? 0.15: 0));
        if(t>6){ clearInterval(interval); flash.remove(); }
      },90);
    }
     </script>
</body>
</html>
